generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int           @id @default(autoincrement())
  phone        String        @unique
  password     String
  inviteCode   String?
  saldo        Float         @default(0.0)
  isAdmin      Boolean       @default(false)
  createdAt    DateTime      @default(now())

  // Relações
  referredBy   Referral?     @relation("UserReferredBy")
  referrals    Referral[]    @relation("UserReferrals")
  transactions Transaction[]
  products     UserProduct[]
  bancos       BancoUsuario[]   // 1..N bancos do usuário (saques)
}

model Product {
  id           Int           @id @default(autoincrement())
  nome         String
  descricao    String?
  valorMinimo  Float
  rendimento   Float    // armazenar como porcentagem (ex: 3.0 = 3% ao dia)
  duracaoDias  Int
  imagem       String?
  ativo        Boolean       @default(true)
  createdAt    DateTime      @default(now())

  users        UserProduct[]
}

model UserProduct {
  id                   Int          @id @default(autoincrement())
  userId               Int
  productId            Int
  investido            Float
  rendimentoAcumulado  Float        @default(0.0)
  createdAt            DateTime     @default(now())

  product              Product       @relation(fields: [productId], references: [id])
  user                 User          @relation(fields: [userId], references: [id])
  dailyYields          DailyYield[]
}

model DailyYield {
  id            Int          @id @default(autoincrement())
  date          DateTime     @default(now())
  amount        Float
  userProductId Int

  userProduct   UserProduct  @relation(fields: [userProductId], references: [id])
}

model Transaction {
  id           Int      @id @default(autoincrement())
  amount       Float
  type         String
  status       String   @default("pending")
  comprovativo String?
  createdAt    DateTime @default(now())
  userId       Int

  user         User     @relation(fields: [userId], references: [id])
}

//
// Bancos da EMPRESA — usados para DEPÓSITOS (lista pública)
//
model BancoEmpresa {
  id        Int     @id @default(autoincrement())
  nome      String
  titular   String
  conta     String
  endereco  String?
}

//
// Bancos DO USUÁRIO — usados para SAQUES (cada usuário pode ter vários)
//
model BancoUsuario {
  id        Int     @id @default(autoincrement())
  banco     String
  titular   String
  conta     String
  userId    Int

  user      User    @relation(fields: [userId], references: [id])
}

model Referral {
  id             Int  @id @default(autoincrement())
  referredUserId Int  @unique
  referrerId     Int

  referredUser   User @relation("UserReferredBy", fields: [referredUserId], references: [id])
  referrer       User @relation("UserReferrals", fields: [referrerId], references: [id])
}
